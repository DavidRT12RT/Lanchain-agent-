# AgentBot con Redis Memory

Un chatbot inteligente con memoria persistente usando Redis y LangChain, con gestiÃ³n avanzada de usuarios y sesiones.

## ğŸš€ CaracterÃ­sticas

- **Memoria Persistente**: Utiliza Redis para mantener el historial de conversaciones entre sesiones
- **GestiÃ³n de Usuarios**: Sistema completo de perfiles de usuario con preferencias y contexto
- **MÃºltiples Herramientas**: Wikipedia, noticias, clima y hora actual
- **Arquitectura Modular**: CÃ³digo organizado en controladores separados
- **Interfaz Web Redis**: Redis Commander para monitoreo y administraciÃ³n
- **ConfiguraciÃ³n Docker**: FÃ¡cil despliegue con docker-compose

## ğŸ“‹ Requisitos

- Python 3.8+
- Docker y Docker Compose
- OpenAI API Key

## ğŸ› ï¸ InstalaciÃ³n

### 1. ConfiguraciÃ³n Manual

```bash
# 1. Instalar dependencias de Python
pip install -r requirements.txt

# 2. Configurar variables de entorno
cp .env.example .env
# Editar .env con tus configuraciones

# 3. Iniciar Redis con Docker
docker-compose up -d

# 4. Verificar que Redis estÃ© funcionando
docker exec agent_redis redis-cli ping
```

## ğŸ“ Estructura del Proyecto

```
â”œâ”€â”€ main.py                    # Archivo principal del bot
â”œâ”€â”€ docker-compose.yml         # ConfiguraciÃ³n de Docker
â”œâ”€â”€ requirements.txt           # Dependencias de Python
â”œâ”€â”€ .env.example              # Plantilla de variables de entorno
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ redis_memory.py       # Memoria personalizada con Redis
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ user_controller.py    # Controlador de usuarios
â””â”€â”€ README.md
```

## ğŸ”§ ConfiguraciÃ³n

### Variables de Entorno (.env)

```env
# OpenAI Configuration
OPENAI_API_KEY=tu_clave_api_de_openai

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB_MEMORY=0
REDIS_DB_USERS=1

# Application Configuration
LOG_LEVEL=INFO
DEFAULT_SESSION_TTL=86400
MAX_MESSAGES_PER_SESSION=100
```

## ğŸš€ Uso

### Uso BÃ¡sico

```python
from main import EnhancedAgentBot

# Crear instancia del bot
bot = EnhancedAgentBot(session_id="usuario123_sesion001")

# Crear usuario
user_data = {
    "user_id": "usuario123",
    "name": "Juan PÃ©rez",
    "email": "juan@ejemplo.com",
    "preferences": {
        "language": "spanish",
        "topics_interest": ["tecnologÃ­a", "ciencia"]
    }
}

# Registrar usuario
result = bot.user_controller.create_user(user_data)

# Obtener respuesta con contexto de usuario
response = bot.get_response("Â¡Hola! Â¿CÃ³mo estÃ¡s?", user_id="usuario123")
print(response["answer"])
```

### GestiÃ³n de Memoria

```python
# Obtener informaciÃ³n de memoria
memory_info = bot.get_memory_info()

# Buscar en el historial
search_results = bot.search_memory("inteligencia artificial")

# Obtener mensajes recientes
recent_messages = bot.get_recent_messages(5)

# Limpiar memoria de la sesiÃ³n
bot.clear_memory()
```

### GestiÃ³n de Usuarios

```python
# Obtener informaciÃ³n del usuario
user_info = bot.user_controller.get_user("usuario123")

# Actualizar preferencias
updates = {
    "preferences": {
        "language": "spanish",
        "notification_time": "evening"
    }
}
bot.user_controller.update_user("usuario123", updates)

# Obtener sesiones del usuario
sessions = bot.user_controller.get_user_sessions("usuario123")

# Listar todos los usuarios
all_users = bot.user_controller.list_all_users()
```

## ğŸ” Monitoreo

### Redis Commander (Interfaz Web)

Accede a `http://localhost:8081` para:
- Ver datos en tiempo real
- Explorar claves de Redis
- Monitorear uso de memoria
- Debug de sesiones y usuarios

### Comandos Docker Ãštiles

```bash
# Ver logs de Redis
docker-compose logs redis

# Detener contenedores
docker-compose down

# Reiniciar contenedores
docker-compose restart

# Acceder a Redis CLI
docker exec -it agent_redis redis-cli

# Ver estadÃ­sticas de Redis
docker exec agent_redis redis-cli info memory
```

## ğŸ—ï¸ Arquitectura

### Componentes Principales

1. **EnhancedAgentBot**: Clase principal que orquesta todo el sistema
2. **RedisMemory**: Memoria personalizada que extiende LangChain para usar Redis
3. **UserController**: Maneja perfiles, sesiones y contexto de usuarios
4. **Tools**: Herramientas integradas (Wikipedia, noticias, clima, tiempo)

### Bases de Datos Redis

- **DB 0**: Historial de conversaciones y memoria de sesiones
- **DB 1**: Perfiles de usuarios y datos de sesiones

### Flujo de Datos

```
Usuario â†’ EnhancedAgentBot â†’ LangChain Agent â†’ Tools
                â†“
         RedisMemory â† â†’ Redis DB 0 (conversaciones)
                â†“
       UserController â† â†’ Redis DB 1 (usuarios)
```

## ğŸ›¡ï¸ CaracterÃ­sticas de Seguridad

- **TTL AutomÃ¡tico**: Las sesiones expiran automÃ¡ticamente
- **LÃ­mite de Mensajes**: Control de memoria por sesiÃ³n
- **Aislamiento**: Bases de datos separadas para diferentes tipos de datos
- **Manejo de Errores**: RecuperaciÃ³n automÃ¡tica de fallos de conexiÃ³n

## ğŸ”„ Escalabilidad

- **Redis Cluster**: Soporte para clustering Redis
- **MÃºltiples Instancias**: FÃ¡cil escalado horizontal
- **Persistencia**: Datos sobreviven a reinicios
- **Backup**: ConfiguraciÃ³n automÃ¡tica de persistencia AOF

## ğŸ› SoluciÃ³n de Problemas

### Redis no se conecta

```bash
# Verificar que Docker estÃ© ejecutÃ¡ndose
docker ps

# Reiniciar contenedores
docker-compose down && docker-compose up -d

# Verificar logs
docker-compose logs redis
```

### Error de dependencias

```bash
# Reinstalar dependencias
pip install --upgrade -r requirements.txt

# Verificar versiÃ³n de Python
python --version  # Debe ser 3.8+
```

### Problemas de memoria

```bash
# Limpiar todas las sesiones
docker exec agent_redis redis-cli FLUSHDB

# Ver uso de memoria
docker exec agent_redis redis-cli info memory
```

## ğŸ“š API Reference

### EnhancedAgentBot

- `get_response(question, user_id)`: Obtener respuesta del agente
- `get_memory_info()`: InformaciÃ³n de memoria actual
- `clear_memory()`: Limpiar memoria de la sesiÃ³n
- `search_memory(query)`: Buscar en el historial
- `get_recent_messages(count)`: Obtener mensajes recientes

### UserController

- `create_user(user_data)`: Crear nuevo usuario
- `get_user(user_id)`: Obtener informaciÃ³n del usuario
- `update_user(user_id, updates)`: Actualizar usuario
- `delete_user(user_id)`: Eliminar usuario
- `get_user_sessions(user_id)`: Obtener sesiones del usuario
- `get_user_context(user_id)`: Obtener contexto para el agente

## ğŸ¤ Contribuciones

Las contribuciones son bienvenidas. Por favor:

1. Fork el proyecto
2. Crea una rama para tu feature
3. Commit tus cambios
4. Push a la rama
5. Abre un Pull Request

## ğŸ“„ Licencia

Este proyecto estÃ¡ bajo la licencia MIT. Ver archivo LICENSE para mÃ¡s detalles.

## ğŸ†˜ Soporte

Si encuentras problemas o tienes preguntas:

1. Revisa la secciÃ³n de soluciÃ³n de problemas
2. Verifica los logs de Docker
3. Crea un issue en el repositorio

---

Â¡Happy coding! ğŸš€